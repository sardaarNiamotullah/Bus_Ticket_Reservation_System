<div *ngIf="selectedBus" class="mt-8 bg-white rounded-lg shadow-lg p-6">
  <!-- Header -->
  <div class="mb-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-2">Select Your Seats</h2>
    <div class="flex items-center gap-2 text-sm text-gray-600">
      <span class="font-semibold">{{ selectedBus.name }}</span>
      <span class="text-gray-400">•</span>
      <span>{{ selectedBus.from }} → {{ selectedBus.to }}</span>
      <span class="text-gray-400">•</span>
      <span>{{ selectedBus.departureTime }}</span>
    </div>
  </div>

  <!-- Legend - Centered with smaller size on mobile -->
  <div
    class="flex flex-wrap gap-2 sm:gap-4 mb-6 p-3 sm:p-4 bg-gray-50 rounded-lg justify-center"
  >
    <div class="flex items-center gap-1.5 sm:gap-2">
      <div
        class="w-6 h-6 sm:w-8 sm:h-8 bg-white border-2 border-gray-300 rounded"
      ></div>
      <span class="text-xs sm:text-sm text-gray-700">Available</span>
    </div>
    <div class="flex items-center gap-1.5 sm:gap-2">
      <div class="w-6 h-6 sm:w-8 sm:h-8 bg-orange-400 rounded"></div>
      <span class="text-xs sm:text-sm text-gray-700">Booked</span>
    </div>
    <div class="flex items-center gap-1.5 sm:gap-2">
      <div class="w-6 h-6 sm:w-8 sm:h-8 bg-red-400 rounded"></div>
      <span class="text-xs sm:text-sm text-gray-700">Sold</span>
    </div>
    <div class="flex items-center gap-1.5 sm:gap-2">
      <div class="w-6 h-6 sm:w-8 sm:h-8 bg-green-500 rounded"></div>
      <span class="text-xs sm:text-sm text-gray-700">Selected</span>
    </div>
  </div>

  <!-- Main Content: Responsive centered layout -->
  <div
    class="flex flex-col sm:flex-row items-center sm:items-start justify-center gap-6 sm:gap-8 lg:gap-12"
  >
    <!-- Seat Map Section - Centered on mobile -->
    <div class="w-full sm:w-auto flex flex-col items-center sm:items-start">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Seat Layout</h3>

      <!-- Container for driver and seats - ensures proper alignment -->
      <div class="inline-block">
        <!-- Driver Section - Perfectly aligned with right seats -->
        <div class="flex items-start mb-4">
          <!-- Empty space for seats 1 & 2 -->
          <div class="flex gap-2">
            <div class="w-12"></div>
            <div class="w-12"></div>
          </div>

          <!-- Aisle -->
          <div class="w-8"></div>
          <button
            type="button"
            disabled
            class="bg-gray-200 rounded-lg flex items-center justify-center cursor-not-allowed ml-4"
            style="width: 104px; height: 48px"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-6 w-6 text-gray-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
          </button>
        </div>

        <!-- Seats Grid -->
        <div class="space-y-3">
          <div
            *ngFor="let row of getSeatRows(); let rowIndex = index"
            class="flex items-center gap-2"
          >
            <!-- Left Pair (Seats 1, 2, etc.) -->
            <div class="flex gap-2">
              <button
                *ngFor="let seat of row.slice(0, 2)"
                type="button"
                (click)="toggleSeat(seat)"
                [class]="getSeatClass(seat)"
                [disabled]="seat.isBooked || seat.isSold"
                class="w-12 h-12 rounded-lg font-semibold text-sm transition-all duration-200 flex items-center justify-center shadow-sm"
              >
                {{ seat.number }}
              </button>
            </div>

            <!-- Aisle -->
            <div class="w-8"></div>

            <!-- Right Pair (Seats 3, 4, etc.) -->
            <div class="flex gap-2">
              <button
                *ngFor="let seat of row.slice(2, 4)"
                type="button"
                (click)="toggleSeat(seat)"
                [class]="getSeatClass(seat)"
                [disabled]="seat.isBooked || seat.isSold"
                class="w-12 h-12 rounded-lg font-semibold text-sm transition-all duration-200 flex items-center justify-center shadow-sm"
              >
                {{ seat.number }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Booking Form Section - Hidden on mobile, visible from sm (640px) and up -->
    <div class="hidden sm:block w-full sm:w-80 lg:w-96">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">
        Passenger Details
      </h3>

      <form [formGroup]="bookingForm" class="space-y-4">
        <!-- Selected Seats Info -->
        <div
          *ngIf="selectedSeats.length > 0"
          class="p-4 bg-green-50 border border-green-200 rounded-lg"
        >
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm font-semibold text-gray-700"
              >Selected Seats:</span
            >
            <span class="text-sm font-bold text-green-700">{{
              selectedSeats.join(", ")
            }}</span>
          </div>
          <div class="flex items-center justify-between">
            <span class="text-sm font-semibold text-gray-700"
              >Total Amount:</span
            >
            <span class="text-xl font-bold text-green-700"
              >৳{{ getTotalAmount() }}</span
            >
          </div>
        </div>

        <!-- No Seats Selected Warning -->
        <div
          *ngIf="selectedSeats.length === 0"
          class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg"
        >
          <p class="text-sm text-yellow-800">
            <span class="font-semibold">Note:</span> Please select at least one
            seat to continue
          </p>
        </div>

        <!-- Name Input -->
        <div>
          <label
            for="name"
            class="block text-sm font-medium text-gray-700 mb-2"
          >
            Full Name <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="name"
            formControlName="name"
            placeholder="Enter your full name"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none transition"
            [class.border-red-500]="
              bookingForm.get('name')?.invalid &&
              bookingForm.get('name')?.touched
            "
          />
          <span
            *ngIf="
              bookingForm.get('name')?.invalid &&
              bookingForm.get('name')?.touched
            "
            class="text-red-500 text-xs mt-1 block"
          >
            <span *ngIf="bookingForm.get('name')?.errors?.['required']"
              >Name is required</span
            >
            <span *ngIf="bookingForm.get('name')?.errors?.['minlength']"
              >Name must be at least 3 characters</span
            >
          </span>
        </div>

        <!-- Email Input -->
        <div>
          <label
            for="email"
            class="block text-sm font-medium text-gray-700 mb-2"
          >
            Email Address <span class="text-red-500">*</span>
          </label>
          <input
            type="email"
            id="email"
            formControlName="email"
            placeholder="Enter your email"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none transition"
            [class.border-red-500]="
              bookingForm.get('email')?.invalid &&
              bookingForm.get('email')?.touched
            "
          />
          <span
            *ngIf="
              bookingForm.get('email')?.invalid &&
              bookingForm.get('email')?.touched
            "
            class="text-red-500 text-xs mt-1 block"
          >
            <span *ngIf="bookingForm.get('email')?.errors?.['required']"
              >Email is required</span
            >
            <span *ngIf="bookingForm.get('email')?.errors?.['email']"
              >Please enter a valid email</span
            >
          </span>
        </div>

        <!-- Action Buttons -->
        <div class="grid grid-cols-2 gap-4 pt-4">
          <button
            type="button"
            (click)="onBook()"
            [disabled]="bookingForm.invalid || selectedSeats.length === 0"
            class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors duration-200 shadow-md hover:shadow-lg"
          >
            Book
          </button>
          <button
            type="button"
            (click)="onBuy()"
            [disabled]="bookingForm.invalid || selectedSeats.length === 0"
            class="px-6 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors duration-200 shadow-md hover:shadow-lg"
          >
            Buy
          </button>
        </div>

        <!-- Info Text -->
        <div class="text-xs text-gray-500 text-center pt-2">
          <p><strong>Book:</strong> Reserve seats temporarily</p>
          <p><strong>Buy:</strong> Purchase and confirm seats immediately</p>
        </div>
      </form>
    </div>
  </div>

  <!-- Mobile Booking Form (Below seat map, only visible on mobile) -->
  <div class="sm:hidden mt-8 w-full">
    <h3 class="text-lg font-semibold text-gray-800 mb-4">Passenger Details</h3>

    <form [formGroup]="bookingForm" class="space-y-4">
      <!-- Selected Seats Info -->
      <div
        *ngIf="selectedSeats.length > 0"
        class="p-4 bg-green-50 border border-green-200 rounded-lg"
      >
        <div class="flex items-center justify-between mb-2">
          <span class="text-sm font-semibold text-gray-700"
            >Selected Seats:</span
          >
          <span class="text-sm font-bold text-green-700">{{
            selectedSeats.join(", ")
          }}</span>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-sm font-semibold text-gray-700">Total Amount:</span>
          <span class="text-xl font-bold text-green-700"
            >৳{{ getTotalAmount() }}</span
          >
        </div>
      </div>

      <!-- No Seats Selected Warning -->
      <div
        *ngIf="selectedSeats.length === 0"
        class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg"
      >
        <p class="text-sm text-yellow-800">
          <span class="font-semibold">Note:</span> Please select at least one
          seat to continue
        </p>
      </div>

      <!-- Name Input -->
      <div>
        <label
          for="name-mobile"
          class="block text-sm font-medium text-gray-700 mb-2"
        >
          Full Name <span class="text-red-500">*</span>
        </label>
        <input
          type="text"
          id="name-mobile"
          formControlName="name"
          placeholder="Enter your full name"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none transition"
          [class.border-red-500]="
            bookingForm.get('name')?.invalid && bookingForm.get('name')?.touched
          "
        />
        <span
          *ngIf="
            bookingForm.get('name')?.invalid && bookingForm.get('name')?.touched
          "
          class="text-red-500 text-xs mt-1 block"
        >
          <span *ngIf="bookingForm.get('name')?.errors?.['required']"
            >Name is required</span
          >
          <span *ngIf="bookingForm.get('name')?.errors?.['minlength']"
            >Name must be at least 3 characters</span
          >
        </span>
      </div>

      <!-- Email Input -->
      <div>
        <label
          for="email-mobile"
          class="block text-sm font-medium text-gray-700 mb-2"
        >
          Email Address <span class="text-red-500">*</span>
        </label>
        <input
          type="email"
          id="email-mobile"
          formControlName="email"
          placeholder="Enter your email"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none transition"
          [class.border-red-500]="
            bookingForm.get('email')?.invalid &&
            bookingForm.get('email')?.touched
          "
        />
        <span
          *ngIf="
            bookingForm.get('email')?.invalid &&
            bookingForm.get('email')?.touched
          "
          class="text-red-500 text-xs mt-1 block"
        >
          <span *ngIf="bookingForm.get('email')?.errors?.['required']"
            >Email is required</span
          >
          <span *ngIf="bookingForm.get('email')?.errors?.['email']"
            >Please enter a valid email</span
          >
        </span>
      </div>

      <!-- Action Buttons -->
      <div class="grid grid-cols-2 gap-4 pt-4">
        <button
          type="button"
          (click)="onBook()"
          [disabled]="bookingForm.invalid || selectedSeats.length === 0"
          class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors duration-200 shadow-md hover:shadow-lg"
        >
          Book
        </button>
        <button
          type="button"
          (click)="onBuy()"
          [disabled]="bookingForm.invalid || selectedSeats.length === 0"
          class="px-6 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors duration-200 shadow-md hover:shadow-lg"
        >
          Buy
        </button>
      </div>

      <!-- Info Text -->
      <div class="text-xs text-gray-500 text-center pt-2">
        <p><strong>Book:</strong> Reserve seats temporarily</p>
        <p><strong>Buy:</strong> Purchase and confirm seats immediately</p>
      </div>
    </form>
  </div>
</div>
